2018年3月1日

起草者：
* 姚旭(yaoxu@h3d.com.cn)



本文档按照cpp提供的语法特性来划分，会涉及如下相关的规范和建议:

* [注释规范](#S-comment)
* [接口规范](#S-interface)
* class规范
* 模板与泛型编程规范
* 标准库使用规范
* cpp11规范
* 命名建议
* 排版建议

规范并不能覆盖到每个方面,你可以先查看[摘要](#S-abstract)，或者直接通过条目跳转。以下分类来自CppCorGuidlines，是上面没有完整覆盖到,可能有争议的分类:

* 代码哲学
* 资源管理
* 错误处理
* 性能

# 摘要
文档所表达的不是死板生硬的规则，而且传达使用CPP的价值观。规则的实施，总是在现实世界会有所出入，所以我们总是应该以最高标准来要求自己。

规范的目标是写出来<b>可维护</b>，让人阅读的代码，这在一定程度上是会影响设计。

但是像命名规范和大括号缩进对于维和没有任何意思，而阅读会有所改观，在这里使用"建议"一词与"规范"分开。

# <a name="S-comment"></a> 注释规范
注释规范应该是最重要，最容易被执行，最容易被忽略的规范。对于注释规范，每个人在执行时不仅要对自己代码改进，并且需要对相关代码进行修正，相关代码是一个不明确的概念，这取决于个人的洁癖程度，但至少:

* 修改某函数的某一行，整个函数中的注释都应该被规范

注释规范不是规范格式，而是规范要写什么内容。

### C.0 建议在接口上使用doxygen工具支持的注释写法

##### 原因
[doxygen](http://www.doxygen.nl/)是一个使用足够广泛的格式规范并且配套工具,在一些IDE甚至被内建支持,以至于有人认为这是JavaDoc规则

##### 举例
![doxygen_sample](doxygen.png)
>"doxygen的大概写法"

##### 实施
新加的接口使用这种注释，在发布新接口时顺便改掉老的注释

**引用**:关于[接口](#S-interface)

# C.1 编写的注释不要和代码违背

##### 原因
* 减少代码阅读的时间，只需要关注函数的名字和注释
* 防止因为相信注释而浪费的调试时间
* 觉得注释才是正确的，不能修改代码陷入矛盾

##### 反面教材

    //!读取skin后，进行一些初始化处理
	/**
	遍历skin上的所有顶点，把所有被顶点使用的骨骼状态设为需要更新的
	*/
	void ProcessSkin(const Skin* pSkin);

    if (pSubMesh->GetClassID() == Skin::_GetClassID())
	{
		ProcessSkin((Skin*)(pSubMesh)); //为网格的点赋予正确的骨骼权重
	}

    函数功能变更注释却没有改掉

##### 实施
尽管你不知道别人写的是什么，但是你至少知道自己写的什么，调用什么函数期望什么行为

# <a name="S-interface"></a> 接口规范

狭义上来讲,接口是两个程序之间的协议。广义上来讲，任何.h .hpp文件里面的内容都是接口。对于引擎而言,engine_interface.h应该是代码组织中最重要的部分(实际上大部分的困扰来源于此)。

### I.0 接口应该精确而类型强健

##### 原因
* 类型是最简单也是最好的文档
* 类型会在编译时检查
* 精确的类型有利于优化
* 精确的类型有利于保持函数参数个数更少

##### 反面教材

	virtual float					Picking(const float* Dir, const float* Point, float* vecIntPoint = 0) = 0; //float* 几个float?

使用者很可能是将H3DVec3类型做数据指针转换才能使用这个接口。这个接口上，使用者不知道Dir是要求几个float还，这就让人困惑就会导致使用者很容易犯错。

##### 经典反面教材
	void draw_rect(int, int, int, int);//想想这四个参数是什么?

	draw_rect(p.x,p.y,10,20);//10,20 什么含义?

int类型可以包含的信息太广泛了，我们需要猜测一下这四个int是干什么的。前两个我们能大概知道是'x','y' 坐标,但是后面两个是什么？

是坐标还是大小？注释和参数名字尽管能解决这个困惑，但是使用类型会更加直观：

	void draw_rectangle(Point top_left, Point bottom_right);
    void draw_rectangle(Point top_left, Size height_width);


